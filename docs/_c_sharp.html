<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rebel Fork Framework: C# Scripting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rebel Fork Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_c_sharp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">C# Scripting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="CSharp_About"></a>
About C# Support</h1>
<p>C# support is provided by customized SWIG wrapper interface generator.</p>
<p>Extensive API coverage estimated at 90%+ Support for inheriting native classes and overriding their virtual methods Support for ref parameters Support for native containers (<code>ea::map&lt;T&gt;</code>, <code>ea::unordered_map&lt;T&gt;</code>, <code>ea::vector&lt;T&gt;</code>) Transparently unwrapping <code><a class="el" href="class_urho3_d_1_1_shared_ptr.html" title="Shared pointer template class with intrusive reference counting.">SharedPtr</a>&lt;T&gt;</code> and <code><a class="el" href="class_urho3_d_1_1_weak_ptr.html" title="Weak pointer template class with intrusive reference counting. Does not keep the object pointed to al...">WeakPtr</a>&lt;T&gt;</code> Serialization and deserialization of managed components Member variable and method renaming to match C# conventions Support for registering C# fields as attributes Managed editor plugins with hot code reload</p>
<h2><a class="anchor" id="CSharp_Requirements"></a>
Requirements</h2>
<p>.NET framework (4.7+) (Windows) Mono (5.4+) (Linux/MacOS/Android/iOS) <code>-DBUILD_SHARED_LIBS=ON</code> build parameter. <code>-DURHO3D_CSHARP=ON</code> build parameter. <code>-DURHO3D_PLUGINS=ON</code> build parameter (optional).</p>
<h2><a class="anchor" id="CSharp_IDE"></a>
IDE support</h2>
<p>On Windows it is advised to use Visual Studio. C# projects will be automatically embedded into generated solution. C# code can be edited and debugged, including hot-reloadable plugins running in the editor. To debug these plugins set <code>EditorHost</code> as your startup application and start debugger.</p>
<h2><a class="anchor" id="CSharp_Scripting"></a>
Scripting</h2>
<p>Building engine with <code>-DURHO3D_PLUGINS=ON</code> includes a dummy plugin that is in charge of compiling <code>Scripts/*.cs</code> files from resource path at runtime. Build option name is rather misleading because said flag actually implements hot code reload in the editor, by building reloadable code as plugins that can be loaded and unloaded.</p>
<h1><a class="anchor" id="CSharp_Implementation"></a>
Implementation details</h1>
<p>Due to differences between C++ and C# languages generated bindings are inherently unsafe. Wrapper tries to make usage as transparent as possible.</p>
<p>There are two kinds of wrapped objects:</p>
<ol type="1">
<li>Objects that inherit from <a class="el" href="class_urho3_d_1_1_ref_counted.html" title="Base class for intrusively reference-counted objects. These are noncopyable and non-assignable.">RefCounted</a>.</li>
<li>Objects that do not inherit from <a class="el" href="class_urho3_d_1_1_ref_counted.html" title="Base class for intrusively reference-counted objects. These are noncopyable and non-assignable.">RefCounted</a>.</li>
</ol>
<h2><a class="anchor" id="CSharp_RefCounted_Subclass"></a>
Using RefCounted objects</h2>
<p>Memory management of RefCounted objects is semi-manual in C# code. There are three rules that user must follow in order to achieve deterministic object destruction.</p>
<ol type="1">
<li>Always call <code>obj.Dispose()</code> when <code>obj</code> is no longer in use. Required if object is constructed using <a class="el" href="class_urho3_d_1_1_object_reflection_registry.html#aa4c7022e1baede1c334692c5ee7e0b67">Context::CreateObject</a> or <code>new</code> keyword. Failure to dispose of object when required will defer object deallocation to garbage collector. A good practice is to always call <code>obj.Dispose()</code> or use <code>using</code> pattern, without being concerned whether it is required or not.</li>
<li>Always call <a class="el" href="class_urho3_d_1_1_ref_counted.html#a4fc22bbadc7156e973997271cba3d13b">RefCounted::AddRef</a> if you intend to hold object reference for a prolonged period of time. Optional, if object is constructed using <a class="el" href="class_urho3_d_1_1_object_reflection_registry.html#aa4c7022e1baede1c334692c5ee7e0b67">Context::CreateObject</a> or <code>new</code> keyword.</li>
<li>Always call <a class="el" href="class_urho3_d_1_1_ref_counted.html#a8d7d984bb64df3b052095bbf4e55bbd5">RefCounted::ReleaseRef</a> for each corresponding <a class="el" href="class_urho3_d_1_1_ref_counted.html#a4fc22bbadc7156e973997271cba3d13b">RefCounted::AddRef</a> call, when you are done using the object. <a class="el" href="class_urho3_d_1_1_ref_counted.html#a8d7d984bb64df3b052095bbf4e55bbd5">RefCounted::ReleaseRef</a> will immdeiately free an underlying native object when last reference is released, managed object will enter "expired" state (<code>RefCounted.Expired</code> will return <code>true</code>). Calls to <code>obj.Dispose()</code> are noop after object is freed. Failure to release a reference when required will result in memory leaks.</li>
</ol>
<p>C# object is a thin wrapper object containing a pointer to a native object implementing core logic. Manual memory management means that C# code may hold an expired reference. This happens when engine owned an object, user accessed it, saved reference to an object and engine freed this object. For example <a class="el" href="class_urho3_d_1_1_scene.html">Scene</a> owns it's \Node instances. If user saved a reference to a particular <a class="el" href="class_urho3_d_1_1_node.html">Node</a> and this node was later removed from the scene - saved instance is no longer valid. In order to determine validity of a reference please use <code>RefCounted.Expired</code> or <code>RefCounted.NotExpired</code> properties.</p>
<p><a class="el" href="class_urho3_d_1_1_engine.html" title="Urho3D engine. Creates the other subsystems.">Engine</a> guarantees that a wrapper C# object will never be destroyed unless a native instance is also destroyed.</p>
<p>Please implement <code>protected override void Dispose(bool disposing)</code> method and implement any logic for releasing resources. <a class="el" href="class_urho3_d_1_1_engine.html" title="Urho3D engine. Creates the other subsystems.">Engine</a> guarantees that user's implementation of <code>Dispose(true)</code> will be called before native object is freed.</p>
<h2><a class="anchor" id="CSharp_Non_RefCounted_Subclasses"></a>
Other classes</h2>
<p>When class does not inherit from <a class="el" href="class_urho3_d_1_1_ref_counted.html">Urho3D::RefCounted</a> - it's lifetime is managed manually. Managed instances of such objects can be returned as owning references or non-owning references.</p>
<p>Owning reference allocates it's native object instance and frees it when instances <code>Dispose()</code> method is called. These objects must be referenced through their entire lifetime and disposed of manually. If such object is passed to the engine API - object must remain alive as long as engine is using this object.</p>
<p>Non-owning references only provide a temporary wrapper around native object. Such instances are returned when <code>T&amp;</code> object is accessed. In this case engine manages lifetime of the object and it is not safe to keep a reference to such object in managed code.</p>
<p>Wrapper keeps a cache of wrapped native pointers and their wrappers. Non-owning wrapper object will reside in cache for some time and be reused. Example of such behavior is <code>VariantMap</code> parameter passed to event handler. Every time such argument is returned a hashmap lookup is performed to retrieve cached wrapper object from the cache.</p>
<h1><a class="anchor" id="CSharp_Best_Practices"></a>
Best practices</h1>
<p><a class="el" href="class_urho3_d_1_1_object.html">Object</a> reference counting is atomic, but not thread-safe. Executing <a class="el" href="class_urho3_d_1_1_ref_counted.html#a8d7d984bb64df3b052095bbf4e55bbd5">RefCounted::ReleaseRef</a> when object has one reference and calling <code>Dispose()</code> method of managed instance on different thread is undefined behavior. Note that "Dispose(false)" may be implicitly called from a finalizer thread if all the references to managed object are lost.</p>
<p>Classes that inherit from native classes should override <code>Dispose(bool)</code>` method and dispose of other native resources class owns. Failure to do so may or may not result in memory leaks. Wrapper does free native resources in object finalizer but managed runtime does not guarantee execution of finalizers, nor their execution is deterministic.</p>
<p>It is advised to manually dispose objects by calling their <code>Dispose()</code> method. In order to dispose object it must have 1 remaining reference. This means that native objects may not keep any references to object that is being disposed. Calling <code>Dispose()</code> on an object with more than 1 reference will throw an exception and leave an object in an unknown state, therefore caching of such exceptions is not advised. Instead application should be fixed to not throw them.</p>
<p>Calling <code>Dispose()</code> on non-owning wrapper instances will dispose of managed wrapper instance only. Native object is not freed and may be accessed later.</p>
<h1><a class="anchor" id="CSharp_Common_Problems"></a>
Common Problems</h1>
<h2><a class="anchor" id="CSharp_BadImageFormatException"></a>
BadImageFormatException</h2>
<p><a class="el" href="class_urho3_d_1_1_application.html" title="Base class for creating applications which initialize the Urho3D engine and run a main loop until exi...">Application</a> may throw a <code>BadImageFormatException</code> on startup if you configured <code>PlatformTarget</code> property of your <code>.csproj</code> incorrectly. Always set <code>PlatformTarget</code> to your target platform. <code>x64</code> for 64bit and <code>x86</code> for 32bit. Never use <code>AnyCPU</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
        <li class="navelem"><a class="el" href="index.html">Home</a></li><li class="navelem"><a class="el" href="_legacy_documentation.html">Legacy Documentation</a></li>
    </ul>
</div>
</body>
</html>
