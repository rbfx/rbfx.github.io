<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rebel Fork Framework: Network Objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rebel Fork Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('network-objects.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Network Objects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p><code>NetworkObject</code> represents an independent entity with unique ID that is automatically replicated over network. <code>NetworkObject</code> doesn't contain any useful behaviors, but it can be derived to implement arbitrary replication logic.</p>
<p><b>Note</b>: <code>Node</code> may have <em>at most</em> one <code>NetworkObject</code> component attached.</p>
<p><b>Note</b>: The client code <em>must never</em> create <code>NetworkObject</code> components on its own!</p>
<h1>Lifetime</h1>
<p>When user creates <code>NetworkObject</code> on the server, the following replication sequence is performed:</p>
<ol type="1">
<li>Unique ID is assigned to this <code>NetworkObject</code>.</li>
</ol>
<ol type="1">
<li>If this object is not relevant for the client, it is not replicated and nothing else happens.</li>
</ol>
<ol type="1">
<li><p class="startli">Server sends the snapshot that consists of:</p><ol type="a">
<li>Unique ID of the <code>NetworkObject</code>.</li>
</ol>
<ol type="a">
<li>Type of the derived component.</li>
</ol>
<ol type="a">
<li>User-defined payload of data.</li>
</ol>
<p class="startli">Note that <code>NetworkObject</code> itself doesn't write <em>any</em> information about the nodes being replicated.</p>
</li>
</ol>
<ol type="1">
<li>When client reads the snapshot, it does the following:<ol type="a">
<li>New node is created in the <code>Scene</code>.</li>
</ol>
<ol type="a">
<li>New <code>NetworkObject</code> component of specified type is created for this node.</li>
</ol>
<ol type="a">
<li>User-defined payload is read.</li>
</ol>
</li>
</ol>
<p>It's up to derived classes to provide necessary data payload.</p>
<p>When the server removes <code>NetworkObject</code>, the client executes <code>NetworkObject::PrepareToRemove</code> and removes the <code>NetworkObject</code> <em>component</em>.</p>
<p>Default implementation of <code>NetworkObject::PrepareToRemove</code> removes the owner <code>Node</code> as well, but this behavior may be overridden at your own risk.</p>
<h1>Ownership</h1>
<p>Server may assign ownership to the <code>NetworkObject</code> by calling <code>NetworkObject::SetOwner</code> right after <code>NetworkObject</code> is created.</p>
<p>Ownership may not be changed afterwards.</p>
<p><code>ServerReplicator</code> tracks all <code>NetworkObject</code>s owned by all clients. <code>ClientReplica</code> tracks all <code>NetworkObject</code>s owned by itself.</p>
<p>Only <code>NetworkObject</code>s owned by the client may send the data from this client back to the server.</p>
<h1>Mode</h1>
<p>User code can check the mode of <code>NetworkObject</code> to have different behaviors on the client and the server.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mode </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Standalone</code> </td><td class="markdownTableBodyNone">The scene is running in standalone mode, <em>or</em> the <code>NetworkObject</code> has just been created and is not yet processed by the client or the server.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Server</code> </td><td class="markdownTableBodyNone">The scene is running on the server. The <code>NetworkObject</code> has been processed by the <code>ReplicationManager</code> and is possibly replicated on remote clients.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ClientReplicated</code> </td><td class="markdownTableBodyNone">The scene is running on the client. The <code>NetworkObject</code> has been fully created. The <code>NetworkObject</code> is not owned by this connection.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ClientOwned</code> </td><td class="markdownTableBodyNone">The scene is running on the client. The <code>NetworkObject</code> has been fully created. The <code>NetworkObject</code> is owned by this connection.  </td></tr>
</table>
<p>Note that <code>NetworkObjectMode</code> are assigned <em>after</em> <code>InitializeOnServer</code> or <code>InitializeFromSnapshot</code> callbacks. This is intentional and allows to distinguish objects that are being initialized now from already processed objects.</p>
<h1>Relevance</h1>
<p><code>NetworkObjectRelevance</code> indicates how much does any specific client cares about this <code>NetworkObject</code>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Relevance </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Irrelevant</code> </td><td class="markdownTableBodyNone">The client is not interested in this <code>NetworkObject</code> and it won't be aware of this object.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>NoUpdates</code> </td><td class="markdownTableBodyNone">The client will not receive unreliable updates, but it will be aware of this object and will receive reliable updates.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NormalUpdates</code> </td><td class="markdownTableBodyNone">The client needs normal updates for this <code>NetworkObject</code>. This is default relevance of any <code>NetworkObject</code>.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Any number greater than 1 </td><td class="markdownTableBodyNone">The client needs throttled unreliable updates for this <code>NetworkObject</code>. Only every N-th unreliable update will be sent to the client.  </td></tr>
</table>
<h1>Hierarchy</h1>
<p>Hierarchy of <code>NetworkObject</code>s is tracked on server, and it is guaranteed that parent <code>NetworkObject</code> is processed before a child <code>NetworkObject</code>.</p>
<p>However, <code>NetworkObject</code> doesn't replicate this hierarchy on its own and it's up to derived classes to preserve this hierarchy on the client.</p>
<h1>Updates</h1>
<p>When <code>NetworkObject</code> is created on the client, it is created from the snapshot. Client receives exactly one snapshot for any specific <code>NetworkObject</code>.</p>
<p>There are three types of updates that <code>NetworkObject</code> may receive after the snapshot.</p>
<ul>
<li><p class="startli"><b>Reliable update</b> is sent to the client.</p>
<p class="startli">It should contain the only the data crucial for game logic. When client receives reliable update, it is guaranteed that:</p><ul>
<li>The client has already received either a snapshot or previous reliable update.</li>
<li>Reliable updates, creation and destruction <em>of all <code>NetworkObject</code>s</em> are processed in the same order as they happen on the server.</li>
</ul>
</li>
<li><p class="startli"><b>Unreliable update</b> is sent to the client.</p>
<p class="startli">Is should contain the data that needs to be delivered quickly.</p>
<p class="startli">No guarantees are given for unreliable updates. For example:</p><ul>
<li>Unreliable update may be lost and never processed by the client.</li>
<li>Unreliable update may be processed in the arbitrary order.</li>
<li>Unreliable update may be processed at arbitrary time relative to reliable updates.</li>
</ul>
</li>
<li><p class="startli"><b>Unreliable feedback</b> is similar to <b>Unreliable update</b>, except it is sent from the client to the server.</p>
<p class="startli">It is usually used to handle user input.</p>
</li>
</ul>
<h1>Interface</h1>
<p><code>NetworkObject</code> provides a variety of virtual methods that may be overridden.</p>
<p>These methods are called when the server is running:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>InitializeOnServer</code> </td><td class="markdownTableBodyNone">Called for every <code>NetworkObject</code> before any server-side processing.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>GetRelevanceForClient</code> </td><td class="markdownTableBodyNone">Evaluates the relevance of the <code>NetworkObject</code> for specified client connection.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WriteSnapshot</code> </td><td class="markdownTableBodyNone">Writes a data payload that should be sufficient to construct the object on the client.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>PrepareReliableDelta</code> </td><td class="markdownTableBodyNone">Checks whether the <code>NetworkObject</code> has changed and reliable update is required for all interested clients.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WriteReliableDelta</code> </td><td class="markdownTableBodyNone">Writes data payload for reliable update.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>PrepareUnreliableDelta</code> </td><td class="markdownTableBodyNone">Checks whether the <code>NetworkObject</code> needs to send unreliable update. You may want to send the same thing several times due to possible update loss.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WriteUnreliableDelta</code> </td><td class="markdownTableBodyNone">Writes data payload for unreliable update.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ReadUnreliableFeedback</code> </td><td class="markdownTableBodyNone">Reads data payload from the client.  </td></tr>
</table>
<p>These methods are called when the client is running:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>InitializeFromSnapshot</code> </td><td class="markdownTableBodyNone">Called for every <code>NetworkObject</code> before any client-side processing. Contains payload from <code>WriteSnapshot</code>.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>PrepareToRemove</code> </td><td class="markdownTableBodyNone">Called before object removal.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>InterpolateState</code> </td><td class="markdownTableBodyNone">Called in the beginning of each frame after processing incoming messages.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ReadReliableDelta</code> </td><td class="markdownTableBodyNone">Reads the data payload of reliable update.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ReadUnreliableDelta</code> </td><td class="markdownTableBodyNone">Reads the data payload of unreliable update.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>PrepareUnreliableFeedback</code> </td><td class="markdownTableBodyNone">Checks whether the owned <code>NetworkObject</code> needs to send feedback to the server.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WriteUnreliableFeedback</code> </td><td class="markdownTableBodyNone">Writes data payload for feedback.  </td></tr>
</table>
<p>These methods are unrelated to client or server:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>InitializeStandalone</code> </td><td class="markdownTableBodyNone">Called for every <code>NetworkObject</code> created in the <code>Scene</code> that is not (yet) handled by the server-side or client-side logic.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Update</code> </td><td class="markdownTableBodyNone">Similar to <code>SceneUpdate</code> event, but it is aware of the network context. In <code>Standalone</code> mode it's identical to <code>SceneUpdate</code> event. In <code>Server</code> mode it's called with fixed rate and fixed time step. In <code>Client</code> mode it is called like normal <code>SceneUpdate</code> but with dilated time steps corresponding to the changes in <b>ReplicaTime</b> and <b>InputTime</b>.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>OnTransformUpdated</code> </td><td class="markdownTableBodyNone">Called when the <code>NetworkObject</code> transform or place in the node hierarchy changes.  </td></tr>
</table>
<h1>Built-in Implementations</h1>
<p>See <a class="el" href="standard-network-objects.html">Standard Network Objects</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
        <li class="navelem"><a class="el" href="index.html">Home</a></li><li class="navelem"><a class="el" href="documentation.html">Documentation</a></li><li class="navelem"><a class="el" href="framework-overview.html">Framework Overview</a></li><li class="navelem"><a class="el" href="multiplayer-and-networking.html">Multiplayer and Networking</a></li>
    </ul>
</div>
</body>
</html>
