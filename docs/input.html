<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rebel Fork Framework: Input</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Rebel Fork Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('input.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Input</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Input system is inherited from the original implementation in Urho3D game engine.</p>
<p>The Input subsystem provides keyboard, mouse, joystick and touch input both via a polled interface and events. This subsystem is also used for querying whether the application window has input focus or is minimized.</p>
<p>The subsystem is always instantiated, even in headless mode, but is active only once the application window has been created. Once active, the subsystem takes over the operating system mouse cursor. It will be hidden by default, so the UI should be used to render a software cursor if necessary. For editor-like applications the operating system cursor can be made visible by calling SetMouseVisible().</p>
<p>The input events include:</p>
<ul>
<li>E_MOUSEBUTTONUP: a mouse button was released.</li>
<li>E_MOUSEBUTTONDOWN: a mouse button was pressed.</li>
<li>E_MOUSEMOVE: the mouse moved.</li>
<li>E_MOUSEWHEEL: the mouse wheel moved.</li>
<li>E_KEYUP: a key was released.</li>
<li>E_KEYDOWN: a key was pressed.</li>
<li>E_TEXTINPUT: a string of translated text input in UTF8 format. May - contain a single character or several.</li>
<li>E_JOYSTICKCONNECTED: a joystick was plugged in.</li>
<li>E_JOYSTICKDISCONNECTED: a joystick was disconnected.</li>
<li>E_JOYSTICKBUTTONDOWN: a joystick button was pressed.</li>
<li>E_JOYSTICKBUTTONUP: a joystick button was released.</li>
<li>E_JOYSTICKAXISMOVE: a joystick axis was moved.</li>
<li>E_JOYSTICKHATMOVE: a joystick POV hat was moved.</li>
<li>E_TOUCHBEGIN: a finger touched the screen.</li>
<li>E_TOUCHEND: a finger was lifted from the screen.</li>
<li>E_TOUCHMOVE: a finger moved on the screen.</li>
<li>E_GESTURERECORDED : recording a touch gesture is complete.</li>
<li>E_GESTUREINPUT : a touch gesture was recognized.</li>
<li>E_MULTIGESTURE : a multi-finger pinch/rotation touch gesture is - underway.</li>
<li>E_DROPFILE : a file was drag-dropped on the application window.</li>
<li>E_INPUTFOCUS : application input focus or window minimization state - changed.</li>
<li>E_MOUSEVISIBLECHANGED : the visibility of the operating system mouse - cursor was changed.</li>
<li>E_EXITREQUESTED : application exit was requested (eg. with the window - close button.)</li>
<li>E_INPUTBEGIN : input handling starts.</li>
<li>E_INPUTEND : input handling ends.</li>
<li>E_SDLRAWINPUT : raw SDL event is sent for customized event processing.</li>
</ul>
<p>Here is a sample code for handling the E_MOUSEBUTTONUP event in Rebel Framework:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> HandleMouseUp(StringHash eventType, VariantMap&amp; eventData)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span>MouseButtonDown;</div>
<div class="line">    <span class="keyword">const</span> MouseButton button = <span class="keyword">static_cast&lt;</span>MouseButton<span class="keyword">&gt;</span>(eventData[P_BUTTON].GetInt());</div>
<div class="line">    <span class="keywordflow">if</span> (button == MOUSEB_LEFT)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Handle left mouse button up</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (button == MOUSEB_RIGHT)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Handle right mouse button up</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">SubscribeToEvent(E_MOUSEBUTTONUP, &amp;MyApplication::HandleMouseUp);</div>
</div><!-- fragment --><p>This code subscribes to the E_MOUSEBUTTONUP event and handles it in the HandleMouseUp function. The eventData parameter contains information about the event, such as which mouse button was released. In this example, the code checks whether the left or right mouse button was released and handles it accordingly.</p>
<h1>Input Map</h1>
<p>The InputMap class is responsible for mapping keyboard keys, gamepad buttons, or axis movement to logical actions in a game engine. The class provides an interface for defining and managing input mappings, which can be used to trigger specific actions in the game.</p>
<p>The InputMap is serializable. You can define default map in game resources and override in a configuration folder. Because of that it is recommended to use the helper method to load the map: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> LoadInputMap(<span class="keyword">const</span> ea::string&amp; name);</div>
</div><!-- fragment --><p> The method looks up map in configuration folder first and only if it is missing there it loads one from resources.</p>
<p>If you have no intention to allow user to define key mappings you can fetch it from ResourceCache as any other resource.</p>
<p>To map a keyboard key you can use MapKeyboardKey. </p><div class="fragment"><div class="line">map-&gt;MapKeyboardKey(<span class="stringliteral">&quot;Forward&quot;</span>, SCANCODE_W);</div>
</div><!-- fragment --><p> Keyboard mapping is based on scancodes. Scancodes are unique codes assigned to each key on a keyboard. They are used to identify the physical key pressed, regardless of the keyboard layout or language. In games, scancodes are used to support international keyboard layouts by providing a consistent way to identify keys across different keyboards and languages.</p>
<p>For example, if a game uses the "WASD" keys for movement, it can map the scancodes for those keys to the movement action in the game. This allows players to use any keyboard layout or language and still be able to move their character using the same physical keys. For example in France, the most commonly used keyboard layout is AZERTY. It is similar to the QWERTY layout used in English-speaking countries, but with a few differences. For example, the letters A and Q are swapped, as are the letters Z and W.</p>
<p>To get value from the map use Evaluate method. </p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">float</span> forward = map-&gt;Evaluate(<span class="stringliteral">&quot;Forward&quot;</span>);</div>
</div><!-- fragment --><p> This means that the map finds a matching mapping and reads its value directly from Input system. The value returned is between 0 and 1, where 0 means the key is not pressed and 1 means the key is pressed. Some input devices have analog input, which means you can get any value between 0 and 1.</p>
<p>To map gamepad analog stick axis use MapJoystickAxis or MapControllerAxis method. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MapJoystickAxis(<span class="keyword">const</span> ea::string&amp; action, <span class="keywordtype">unsigned</span> axis, <span class="keywordtype">float</span> neutral, <span class="keywordtype">float</span> pressed);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MapControllerAxis(<span class="keyword">const</span> ea::string&amp; action, ControllerAxis axis, <span class="keywordtype">float</span> neutral, <span class="keywordtype">float</span> pressed);</div>
</div><!-- fragment --><p>The method takes four parameters:</p>
<ul>
<li>action: A string that specifies the logical action that should be affected when the joystick axis is moved.</li>
<li>axis: For generic joystick the value is an unsigned integer that specifies the joystick axis to map. For a controller the value is ControllerAxis that specifies the controller axis.</li>
<li>neutral: A float value that specifies the neutral position of the joystick axis. This value should be between -1 and 1. For analog sticks it is 0. For triggers the neutral position is -1.</li>
<li>pressed: A float value that specifies the position of the joystick axis when it is fully pressed. This value should be between -1 and 1. Usually the value is either -1 or 1 exactly.</li>
</ul>
<p>The Evaluate method return value of the joystick axis is mapped to a range between neutral and pressed, where neutral represents the neutral position of the joystick and pressed represents the position of the joystick when it is fully pressed.</p>
<p>For example, if you want to map the Y-axis of a gamepad to control the movement of a character in your game, you can use the following code: </p><div class="fragment"><div class="line">map-&gt;MapControllerAxis(<span class="stringliteral">&quot;Forward&quot;</span>, CONTROLLER_AXIS_LEFTY, 0.0f, -1.0f);</div>
</div><!-- fragment --><p>This code maps the negative Y-axis portion of the gamepad analog stick to affect the "Forward" action in your game. The neutral position of the Y-axis is set to 0.0f, which means that when the joystick is in its neutral position, the value of "Forward" will be 0.0f. The fully pressed position of the Y-axis is set to -1.0f, which means that when the axis is fully pressed forward, the value of "Forward" will be 1.0f.</p>
<h2>Using InputMap to control character</h2>
<p>Because the InputMap is a SimpleResource the easiest way to use it in a component is to have an attribute of the InputMap resource type:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> KinematicCharacter::RegisterObject(Context* context)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ....</span></div>
<div class="line">    URHO3D_MIXED_ACCESSOR_ATTRIBUTE(</div>
<div class="line">        <span class="stringliteral">&quot;Input Map&quot;</span>, GetInputMapAttr, SetInputMapAttr, ResourceRef, ResourceRef(InputMap::GetTypeStatic()), AM_DEFAULT);</div>
<div class="line">    <span class="comment">// ....</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> KinematicCharacter::SetInputMapAttr(<span class="keyword">const</span> ResourceRef&amp; value)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span>* cache = GetSubsystem&lt;ResourceCache&gt;();</div>
<div class="line">    SetInputMap(cache-&gt;GetResource&lt;InputMap&gt;(value.name_));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ResourceRef KinematicCharacter::GetInputMapAttr()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> GetResourceRef(inputMap_, InputMap::GetTypeStatic());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> KinematicCharacter::SetInputMap(InputMap* inputMap)</div>
<div class="line">{</div>
<div class="line">    inputMap_ = inputMap;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The InputMap is stateless and because of that it doesn't require any special handling.</p>
<p>When you need to get a value for an action just call Evaluate method. In the following example if Crouch action value is not equal to 0 then the character height is halved: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (inputMap_-&gt;Evaluate(<span class="stringliteral">&quot;Crouch&quot;</span>))</div>
<div class="line">{</div>
<div class="line">    kinematicController_-&gt;SetHeight(0.9f);</div>
<div class="line">    kinematicController_-&gt;SetOffset(Vector3(0.0f, 0.45f, 0.0f));</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">    kinematicController_-&gt;SetHeight(1.8f);</div>
<div class="line">    kinematicController_-&gt;SetOffset(Vector3(0.0f, 0.9f, 0.0f));</div>
<div class="line">}</div>
</div><!-- fragment --><h2>InputMap file format</h2>
<p>InputMap is a SimpleResource and by default is serialized in a JSON format:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;actions&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;key&quot;: &quot;Left&quot;,</div>
<div class="line">            &quot;value&quot;: {</div>
<div class="line">                &quot;axes&quot;: [</div>
<div class="line">                    {</div>
<div class="line">                        &quot;controller&quot;: true,</div>
<div class="line">                        &quot;pressed&quot;: -1.0</div>
<div class="line">                    }</div>
<div class="line">                ],</div>
<div class="line">                &quot;keys&quot;: [</div>
<div class="line">                    {</div>
<div class="line">                        &quot;scancode&quot;: &quot;A&quot;</div>
<div class="line">                    },</div>
<div class="line">                    {</div>
<div class="line">                        &quot;scancode&quot;: &quot;Left&quot;</div>
<div class="line">                    }</div>
<div class="line">                ]</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;key&quot;: &quot;Right&quot;,</div>
<div class="line">            &quot;value&quot;: {</div>
<div class="line">                &quot;axes&quot;: [</div>
<div class="line">                    {</div>
<div class="line">                        &quot;controller&quot;: true</div>
<div class="line">                    }</div>
<div class="line">                ],</div>
<div class="line">                &quot;keys&quot;: [</div>
<div class="line">                    {</div>
<div class="line">                        &quot;scancode&quot;: &quot;D&quot;</div>
<div class="line">                    },</div>
<div class="line">                    {</div>
<div class="line">                        &quot;scancode&quot;: &quot;Right&quot;</div>
<div class="line">                    }</div>
<div class="line">                ]</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The InputMap JSON file contains an array, each of which has a key and a value field. The key field is a string that represents the name of the action, while the value field is an object that contains several fields:</p>
<div class="fragment"><div class="line">&quot;axes&quot;: [</div>
<div class="line">    {</div>
<div class="line">        &quot;axis&quot;: 3,</div>
<div class="line">        &quot;controller&quot;: true,</div>
<div class="line">        &quot;neutral&quot;: 0.0,</div>
<div class="line">        &quot;pressed&quot;: 1.0,</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><ul>
<li><b>axes</b>: The axes field is an array of objects that represent the controller’s axes mapping. Each object in the array has few fields<ul>
<li><b>controller</b> which is a boolean value indicating whether the axis is controlled by a controller. False indicates that the mapping is for generic joystick and true indicates mapping for a gamepad detected by SDL. Default value of the field is false.</li>
<li><b>axis</b> which is an integer value indicating which axis is controlled by a controller. Default value of the field is 0.</li>
<li><b>neutral</b>, which is a floating-point value between -1.0 and 1.0 representing the neutral position of the axis. Default value of the field is 0.0.</li>
<li><b>pressed</b>, which is a floating-point value between -1.0 and 1.0 representing the fully pressed position of the axis. Default value of the field is 1.0.</li>
</ul>
</li>
</ul>
<div class="image">
<img src="gamepad-axis.jpg" alt=""/>
<div class="caption">
XBox Gamepad Axis Map</div></div>
    <div class="fragment"><div class="line">&quot;keys&quot;: [</div>
<div class="line">    {</div>
<div class="line">        &quot;scancode&quot;: &quot;A&quot;</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        &quot;scancode&quot;: &quot;Left&quot;</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><ul>
<li><b>keys</b>: The keys field is an array of objects that represent the keyboard keys mapping. Each object in the array has few fields<ul>
<li><b>scancode</b>, which is a string representing the scancode of the key. The full list of valid values would be too long and you can find it in the InputMap.cpp source file. Here are few notable mentions: "W", "A", "S", "D", "Left", "Right", "Down", "Up", "Escape", "Space".</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">&quot;buttons&quot;: [</div>
<div class="line">    {</div>
<div class="line">        &quot;controller&quot;: true,</div>
<div class="line">        &quot;button&quot;: &quot;X&quot;</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><ul>
<li><b>buttons</b>: The buttons field is an array of objects that represent the controller button mappings. Each object in the array has few fields<ul>
<li><b>controller</b> which is a boolean value indicating whether the axis is controlled by a controller. False indicates that the mapping is for generic joystick and true indicates mapping for a gamepad detected by SDL. Default value of the field is false.</li>
<li><b>button</b>, for a controller the field contains button name and for generic joystick the field contains integer index of the button. Valid controller button names are "A", "B", "X", "Y", "Back", "Guide", "Start", "LeftStick", "RightStick", "LeftShoulder", "RightShoulder", "Up", "Down", "Left", "Right", "Misc1", "Paddle1", "Paddle2", "Paddle3", "Paddle4", "Touchpad". Default value of the field is "A" or 0.</li>
</ul>
</li>
</ul>
<div class="image">
<img src="gamepad-buttons.jpg" alt=""/>
<div class="caption">
XBox Gamepad Button Map</div></div>
    <div class="fragment"><div class="line">&quot;hats&quot;: [</div>
<div class="line">    {</div>
<div class="line">        &quot;hat&quot;: &quot;Down&quot;</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><ul>
<li><b>hats</b>: The field is an array of objects that represent DPad mappings.<ul>
<li><b>hat</b>, which is a string representing DPad direction. Valid values are "Up", "Right", "Down", "Left". Default value of the field is "Up".</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">&quot;mouseButtons&quot;: [</div>
<div class="line">    {</div>
<div class="line">        &quot;button&quot;: &quot;Right&quot;</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><ul>
<li><b>mouseButtons</b>: The field is an array of objects that represent mouse button mappings.<ul>
<li><b>button</b>, which is a string representing mouse button. Valid values are "Left", "Middle", "Right", "X1", "X2". Default value of the field is "Left".</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">&quot;screenButtons&quot;: [</div>
<div class="line">    {</div>
<div class="line">        &quot;elementName&quot;: &quot;Button1&quot;</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><ul>
<li><b>screenButtons</b>: The field is an array of objects that represent screen button mappings.<ul>
<li><b>elementName</b>, which is a string representing UI UIElement id. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
        <li class="navelem"><a class="el" href="index.html">Home</a></li><li class="navelem"><a class="el" href="documentation.html">Documentation</a></li><li class="navelem"><a class="el" href="framework-overview.html">Framework Overview</a></li>
    </ul>
</div>
</body>
</html>
